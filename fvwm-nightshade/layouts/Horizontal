#-----------------------------------------------------------------------
# File:		Horizontal
# Version:	1.0.3
# Licence: 	GPL 2
#
# Description:	Layout of object positions on desktop
#
# Author:	Thomas Funk <t.funk@web.de>	
# Created:	08/16/2012
# Changed:	09/23/2012
#-----------------------------------------------------------------------
#			   Top
#
# +--------+		+--------+		+--------+
# |        |            |        |              |        |
# +--------+		+--------+		+--------+
# IconManager		   Pager		   Panel
#
#-----------------------------------------------------------------------

########################################################################
#                        Positioning
########################################################################

#=======================================================================
# Pager
#=======================================================================

#-----------------------------------------------------------------------
# Set the desk top size in units of physical screen size
#
#   +-----+-----+-----+-----+
#   |     |     |     |     |
#   +-----+-----+-----+-----+
#
#-----------------------------------------------------------------------
DeskTopSize 4x1

#-----------------------------------------------------------------------
# actual pager height. Needed for the "top bar" modules also
#-----------------------------------------------------------------------
PipeRead "echo InfoStoreAdd pager_height `perl -e 'printf \"%.0f\",$[vp.height]/(21*$[infostore.ratio])'`"

#-----------------------------------------------------------------------
# actual pager width
#-----------------------------------------------------------------------
PipeRead "echo InfoStoreAdd pager_width `perl -e 'printf \"%.0f\",$[vp.width]/(4*$[infostore.ratio])'`"

#-----------------------------------------------------------------------
# FvwmPager geometry
#-----------------------------------------------------------------------
PipeRead 'echo InfoStoreAdd pager_geometry $[infostore.pager_width]x$[infostore.pager_height]+$(($[vp.width]/2-$[infostore.pager_width]/2))+0'


#=======================================================================
# Icon Manager (WinList per Page)
#=======================================================================

#-----------------------------------------------------------------------
# actual GlobalIconMan width
#-----------------------------------------------------------------------
PipeRead 'echo InfoStoreAdd iconman_button_width $(($[vp.width]/4))'

#-----------------------------------------------------------------------
# GlobalIconMan geometry
#-----------------------------------------------------------------------
PipeRead 'echo InfoStoreAdd iconman_button_geometry $[infostore.iconman_button_width]x0'

#-----------------------------------------------------------------------
# GlobalIconMan Manager Geometry
#-----------------------------------------------------------------------
PipeRead 'echo InfoStoreAdd iconman_manager_geometry 1x0+0+0'


#=======================================================================
# FvwmButtons Panel
#=======================================================================

#-----------------------------------------------------------------------
# Panel geometry
#-----------------------------------------------------------------------
PipeRead 'echo InfoStoreAdd panel_geometry $[infostore.iconman_button_width]x$[infostore.pager_height]-0+0''


#=======================================================================
# Others
#=======================================================================

#-----------------------------------------------------------------------
# Define bands at the edge of the screen. It is used to compute the
# Working Area: EwmhBaseStruts left right top bottom 
#-----------------------------------------------------------------------
PipeRead 'echo EwmhBaseStruts 0 0 $(($[infostore.pager_height]+3)) 0'

#-----------------------------------------------------------------------
# IconBox defines the area where FVWM will place any windows that are
# in the iconic state: 
#  IconBox left top right bottom
#
# IconGrid ist the distance between each icon. Default grid is 3x3 pixels:
#  IconGrid x y
#
# IconFill defines the direction icons will place. Default is from left
# to right. To fill an icon box in columns instead of rows, specify the
# vertical direction (top or bottom) first.
#-----------------------------------------------------------------------
Style * IconBox 20 80 -100 -20, \
        IconGrid 40 40, \
        IconFill left bottom, \
        StaysOnBottom


#=======================================================================
# Load layout elements
#=======================================================================
Load modules/GlobalIconMan
Load modules/Pager
Load modules/HorizontalPanel


#=======================================================================
# Functions
#=======================================================================

AddToFunc StartFunction
# start window list module
+ I Module FvwmIconMan FvwmGlobalIconMan
#-----------------------------------------------------------------------
# start a Pager
+ I Module FvwmPager
#-----------------------------------------------------------------------
# start horizontal panel
+ I Module FvwmButtons HorizontalPanel
#-----------------------------------------------------------------------
# start systray applets
+ I Wait stalonetray
+ I FuncStartSystrayApplets


DestroyFunc ReloadLayoutParts
AddToFunc   ReloadLayoutParts
+ I PipeRead 'fns-built-trayapplist $FVWM_USERDIR/.systray.log $FVWM_USERDIR/.trayapplist'
+ I Load modules/HorizontalPanel
+ I FuncRestartModuleByAlias FvwmButtons HorizontalPanel
+ I Wait stalonetray
+ I Exec exec fns-start-programs reload_applets $[FVWM_USERDIR]/.trayapplist
